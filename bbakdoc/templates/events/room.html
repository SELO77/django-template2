{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% block title %}Event{% endblock %}

{% block content %}
  <div class="container">
    <div class="page-content room-page">
      <h1 class="page-header">{{ event.title }} ({{ event.code }})</h1>
      <div class="page-body">
        <ul class="ui-tab" id="tab">
          <li class="ui-tab-item">Question</li>
          <li class="ui-tab-item">Poll</li>
          <li class="ui-tab-item">Slide</li>
        </ul>

        <div class="tab-con" id="tab-con">
          <div class="tab-con-question">
            <div class="question-create-area">
              <textarea id="question-input" class="form-textarea" placeholder="질문을 입력하세요"></textarea>
              <button id="question-submit" type="button" class="btn btn-primary btn-send">Send</button>
            </div>
            <div class="question-list-area" id="question-container">
{#              {% if event_questions_list %}#}
{#                {% for event_question in event_questions_list %}#}
{#                  <div>{{ event_question.questioner }} |  {{ event_question.content }} : {{ event_question.likes }}</div>#}
{#                {% endfor %}#}
{#              {% endif %}#}

              <div class="dropdown">
                <select>
                  <option value="">추천순</option>
                  <option value="">최신순</option>
                  <option value="">랜덤순</option>
                </select>
              </div>

              <ul class="question-list">
                <li class="question-item">
                  <p>
                    <span class="q-questioner">지니</span>
                    <span class="q-time">2019-06-09 15:46:30</span>
                  </p>
                  <p class="q-content">질문이 있습니다! 질문이 있습니다! 질문이 있습니다! 질문이 있습니다! 질문이 있습니다! 질문이 있습니다! 질문이 있습니다!</p>
                  <div class="btn-area">
                    <button class="btn-mini btn-primary">고정</button>
                    <button class="btn-mini btn-primary"><span>공감</span><span class="count">0</span></button>
                    <button class="btn-mini btn-primary">삭제</button>
                  </div>
                </li>
                <li class="question-item">
                  <p>
                    <span class="q-questioner">지니</span>
                    <span class="q-time">2019-06-09 15:46:30</span>
                  </p>
                  <p class="q-content">질문이 있습니다! 질문이 있습니다! 질문이 있습니다! 질문이 있습니다! 질문이 있습니다! 질문이 있습니다! 질문이 있습니다!</p>
                  <div class="btn-area">
                    <button class="btn-mini btn-primary">고정</button>
                    <button class="btn-mini btn-primary"><span>공감</span><span class="count">0</span></button>
                    <button class="btn-mini btn-primary">삭제</button>
                  </div>
                </li>
                <li class="question-item">
                  <p>
                    <span class="q-questioner">지니</span>
                    <span class="q-time">2019-06-09 15:46:30</span>
                  </p>
                  <p class="q-content">질문이 있습니다! 질문이 있습니다! 질문이 있습니다! 질문이 있습니다! 질문이 있습니다! 질문이 있습니다! 질문이 있습니다!</p>
                  <div class="btn-area">
                    <button class="btn-mini btn-primary">고정</button>
                    <button class="btn-mini btn-primary"><span>공감</span><span class="count">0</span></button>
                    <button class="btn-mini btn-primary">삭제</button>
                  </div>
                </li>
              </ul>
            </div>
          </div>

          <div class="tab-con-poll">
{#            참석자 #}
            <div class="attendee row">
              <div class="col">
                <h2>Live Poll</h2>
                <p class="poll-title">영어를 좋아합니까?</p>
                <div class="form-group form-check-group">
                  <input type="checkbox" id="check1" class="form-check">
                  <label for="check1">매우 싫다</label>
                </div>
                <div class="form-group form-check-group">
                  <input type="checkbox" id="check2" class="form-check">
                  <label for="check2">싫다</label>
                </div>
                <div class="form-group form-check-group">
                  <input type="checkbox" id="check3" class="form-check">
                  <label for="check3">그럭저럭이다</label>
                </div>
                <div class="form-group form-check-group">
                  <input type="checkbox" id="check4" class="form-check">
                  <label for="check4">좋다</label>
                </div>
                <div class="form-group form-check-group">
                  <input type="checkbox" id="check5" class="form-check">
                  <label for="check5">매우 좋다</label>
                </div>
                <div class="btn-in-row">
                  <button class="btn btn-line-navy" id="btn-open-result">결과보기</button>
                  <button class="btn btn-primary">제출</button>
                </div>
              </div>
              <div class="col result">
                <h2>Poll Result</h2>
                <p class="poll-title">영어를 좋아합니까? (30명 참여)</p>
                <div class="poll-result-area">
                  <ul class="graph-list">
                    <li class="graph-item">
                      <span class="caption">매우 싫다</span>
                      <span class="graph" data-result="3%" style="width: 3%"></span>
                    </li>
                    <li class="graph-item">
                      <span class="caption">싫다</span>
                      <span class="graph" data-result="7%" style="width: 7%"></span>
                    </li>
                    <li class="graph-item">
                      <span class="caption">그럭저럭이다</span>
                      <span class="graph" data-result="0%" style="width: 0%"></span>
                    </li>
                    <li class="graph-item">
                      <span class="caption">좋다</span>
                      <span class="graph" data-result="10%" style="width: 10%"></span>
                    </li>
                    <li class="graph-item highlight">
                      <span class="caption">매우 좋다</span>
                      <span class="graph" data-result="80%" style="width: 80%"></span>
                    </li>
                  </ul>
                </div>
              </div>
            </div>

{#            주최자 #}
            <div class="organizer row">
              <div class="col">
                <div class="create-edit-area" id="create-edit-area">
                  <h2>Create(Edit) Poll</h2>
                  <div class="create-poll-area">
                    <div class="form-group">
                      <label for="poll-title" class="form-label">투표 제목<span class="asteriskField">*</span></label>
                      <input type="text" placeholder="투표 제목을 입력하세요" class="form-input" id="poll-title">
                    </div>
                    <div class="form-group">
                      <label class="form-label">투표 옵션<span class="asteriskField">*</span></label>
                      <input type="text" placeholder="옵션 추가" class="form-input" id="poll-title">
                      <input type="text" placeholder="옵션 추가" class="form-input" id="poll-title">
                      <input type="text" placeholder="옵션 추가" class="form-input" id="poll-title">
                      <input type="text" placeholder="옵션 추가" class="form-input" id="poll-title">
                      <input type="text" placeholder="옵션 추가" class="form-input" id="poll-title">
                    </div>
                    <div class="form-group form-check-group">
                      <input type="checkbox" id="option1" class="form-check">
                      <label for="option1">기타 입력칸 추가</label>
                    </div>
                    <div class="form-group form-check-group">
                      <input type="checkbox" id="option2" class="form-check">
                      <label for="option2">중복선택 허용</label>
                    </div>
                    <div class="form-group form-check-group">
                      <input type="checkbox" id="option3" class="form-check">
                      <label for="option3">결과에 정답 표시하기</label>
                    </div>
                    <div class="btn-in-row">
                      <button class="btn btn-line-navy" id="btn-cancel">취소</button>
                      <button class="btn btn-primary" id="btn-submit">생성</button>
                    </div>
                  </div>
                </div>

                <div class="list-area">
                  <div class="h2-area">
                    <h2>Poll List</h2>
                    <button class="btn-small btn-primary btn-beside-h2" id="btn-create-poll">생성</button>
                  </div>
                  <ul class="poll-list">
                    <li class="poll-item">
                      <p class="poll-item-title">영어를 좋아합니까?</p>
                      <div class="btn-area">
                        <button class="btn-mini btn-line-mustard">수정</button>
                        <button class="btn-mini btn-primary">시작</button>
                        <button class="btn-mini btn-line-navy">종료</button>
                        <button class="btn-mini btn-secondary">결과</button>
                      </div>
                    </li>
                    <li class="poll-item">
                      <p class="poll-item-title">수학를 좋아합니까?</p>
                      <div class="btn-area">
                        <button class="btn-mini btn-line-mustard">수정</button>
                        <button class="btn-mini btn-primary">시작</button>
                        <button class="btn-mini btn-line-navy">종료</button>
                        <button class="btn-mini btn-secondary">결과</button>
                      </div>
                    </li>
                    <li class="poll-item">
                      <p class="poll-item-title">과학를 좋아합니까?</p>
                      <div class="btn-area">
                        <button class="btn-mini btn-line-mustard">수정</button>
                        <button class="btn-mini btn-primary">시작</button>
                        <button class="btn-mini btn-line-navy">종료</button>
                        <button class="btn-mini btn-secondary">결과</button>
                      </div>
                    </li>
                  </ul>
                </div>
              </div>

              <div class="col result">
                <div class="h2-area">
                  <h2>Poll Result</h2>
                  <button class="btn-small btn-primary btn-beside-h2">전체 결과보기</button>
                </div>

                <div class="poll-item-result">
                  <p class="poll-title">영어를 좋아합니까? (30명 참여)</p>
                  <div class="poll-result-area">
                    <ul class="graph-list">
                      <li class="graph-item">
                        <span class="caption">매우 싫다</span>
                        <span class="graph" data-result="3%" style="width: 3%"></span>
                      </li>
                      <li class="graph-item">
                        <span class="caption">싫다</span>
                        <span class="graph" data-result="7%" style="width: 7%"></span>
                      </li>
                      <li class="graph-item">
                        <span class="caption">그럭저럭이다</span>
                        <span class="graph" data-result="0%" style="width: 0%"></span>
                      </li>
                      <li class="graph-item">
                        <span class="caption">좋다</span>
                        <span class="graph" data-result="10%" style="width: 10%"></span>
                      </li>
                      <li class="graph-item highlight">
                        <span class="caption">매우 좋다</span>
                        <span class="graph" data-result="80%" style="width: 80%"></span>
                      </li>
                    </ul>
                  </div>
                </div>

                <div class="poll-item-result">
                  <p class="poll-title">수학를 좋아합니까? (30명 참여)</p>
                  <div class="poll-result-area">
                    <ul class="graph-list">
                      <li class="graph-item">
                        <span class="caption">매우 싫다</span>
                        <span class="graph" data-result="3%" style="width: 3%"></span>
                      </li>
                      <li class="graph-item">
                        <span class="caption">싫다</span>
                        <span class="graph" data-result="7%" style="width: 7%"></span>
                      </li>
                      <li class="graph-item">
                        <span class="caption">그럭저럭이다</span>
                        <span class="graph" data-result="0%" style="width: 0%"></span>
                      </li>
                      <li class="graph-item">
                        <span class="caption">좋다</span>
                        <span class="graph" data-result="10%" style="width: 10%"></span>
                      </li>
                      <li class="graph-item highlight">
                        <span class="caption">매우 좋다</span>
                        <span class="graph" data-result="80%" style="width: 80%"></span>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="tab-con-slide">
            <div class="attendee-view">
              <iframe src="//www.slideshare.net/slideshow/embed_code/key/wZudqqTdctjWXA" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" allowfullscreen></iframe>
              <div class="slide-caption"> <strong> <a href="//www.slideshare.net/carologic/ai-and-machine-learning-demystified-by-carol-smith-at-midwest-ux-2017" title="AI and Machine Learning Demystified by Carol Smith at Midwest UX 2017" target="_blank">AI and Machine Learning Demystified by Carol Smith at Midwest UX 2017</a> </strong> from <strong><a href="https://www.slideshare.net/carologic" target="_blank">Carol Smith</a></strong> </div>
            </div>
            <div class="organizer-view form-group">
              <input type="text" placeholder="슬라이드 주소를 입력하세요" class="form-input">
              <button class="btn btn-primary">확인</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    var eventCode = {{ event.code }};

    var eventRoomSocket = new WebSocket(
      'ws://' + window.location.host +
      '/ws/events/' + eventCode + '/');

    eventRoomSocket.onmessage = function (e) {
      var data = JSON.parse(e.data);
      var text = data['questioner'] + ' |  ' +data['content'] +' : ' + data['likes'];
      var newDiv = document.createElement("DIV");
      newDiv.appendChild(document.createTextNode(text));
      document.querySelector('#question-container').appendChild(newDiv);
    };

    eventRoomSocket.onclose = function (e) {
      console.error('Chat socket closed unexpectedly');
    };

    document.querySelector('#question-input').focus();
    document.querySelector('#question-input').onkeyup = function (e) {
      if (e.keyCode === 13) {  // enter, return
        document.querySelector('#question-submit').click();
      }
    };

    document.querySelector('#question-submit').onclick = function (e) {
      var questionInputDom = document.querySelector('#question-input');
      var question = questionInputDom.value;
      eventRoomSocket.send(JSON.stringify({
        'question': question,
        'questioner': '{{ request.session.nickname }}'
      }));

      questionInputDom.value = '';
    };

    document.querySelector('#btn-create-poll').onclick = function (e){
      document.querySelector('#create-edit-area').classList.add('is-open');
    };

    document.querySelector('#btn-submit, #btn-cancel').onclick = function (e){
      document.querySelector('#create-edit-area').classList.remove('is-open');
    };

    document.querySelector('#btn-open-result').onclick = function (e){
      document.querySelector('.col.result').classList.add('is-open');
    };
  </script>
{% endblock %}

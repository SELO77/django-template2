{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block content %}
  <div class="container">
    <h1>{{ event.title }} ({{ event.code }})</h1>
    <hr>
    <p>Your name is <strong>{{ request.session.nickname }}</strong></p>
    <hr>
    <div id="question-container">
      {% if event_questions_list %}
        {% for event_question in event_questions_list %}
          <div>{{ event_question.questioner }} |  {{ event_question.content }} : {{ event_question.likes }}</div>
        {% endfor %}
      {% endif %}
    </div>
    <br/>
    <label for="question-input">Question -> </label>
    <input id="question-input" type="text" size="100"/><br/>
    <input id="question-submit" type="button" value="Send"/>
  </div>
  <script>
    var eventCode = {{ event.code }};

    var eventRoomSocket = new WebSocket(
      'ws://' + window.location.host +
      '/ws/events/' + eventCode + '/');

    eventRoomSocket.onmessage = function (e) {
      var data = JSON.parse(e.data);
      var text = data['questioner'] + ' |  ' +data['content'] +' : ' + data['likes'];
      var newDiv = document.createElement("DIV");
      newDiv.appendChild(document.createTextNode(text));
      document.querySelector('#question-container').appendChild(newDiv);
    };

    eventRoomSocket.onclose = function (e) {
      console.error('Chat socket closed unexpectedly');
    };

    document.querySelector('#question-input').focus();
    document.querySelector('#question-input').onkeyup = function (e) {
      if (e.keyCode === 13) {  // enter, return
        document.querySelector('#question-submit').click();
      }
    };

    document.querySelector('#question-submit').onclick = function (e) {
      var questionInputDom = document.querySelector('#question-input');
      var question = questionInputDom.value;
      eventRoomSocket.send(JSON.stringify({
        'question': question,
        'questioner': '{{ request.session.nickname }}'
      }));

      questionInputDom.value = '';
    };
  </script>
{% endblock %}

{#{% block javascript %}#}
{#  <script type="text/javascript">#}
{#  #}
{#  </script>#}
{#{% endblock %}#}
